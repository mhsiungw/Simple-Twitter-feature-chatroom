(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-66710989"],{"0465":function(e,t,r){"use strict";r("e71b")},"408a":function(e,t,r){var s=r("e330");e.exports=s(1..valueOf)},"498a":function(e,t,r){"use strict";var s=r("23e7"),a=r("58a8").trim,n=r("c8d2");s({target:"String",proto:!0,forced:n("trim")},{trim:function(){return a(this)}})},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,r){var s=r("e330"),a=r("1d80"),n=r("577e"),i=r("5899"),c=s("".replace),o="["+i+"]",u=RegExp("^"+o+o+"*"),l=RegExp(o+o+"*$"),d=function(e){return function(t){var r=n(a(t));return 1&e&&(r=c(r,u,"")),2&e&&(r=c(r,l,"")),r}};e.exports={start:d(1),end:d(2),trim:d(3)}},7156:function(e,t,r){var s=r("1626"),a=r("861d"),n=r("d2bb");e.exports=function(e,t,r){var i,c;return n&&s(i=t.constructor)&&i!==r&&a(c=i.prototype)&&c!==r.prototype&&n(e,c),e}},"99af":function(e,t,r){"use strict";var s=r("23e7"),a=r("da84"),n=r("d039"),i=r("e8b5"),c=r("861d"),o=r("7b0b"),u=r("07fa"),l=r("8418"),d=r("65f0"),f=r("1dde"),v=r("b622"),h=r("2d00"),p=v("isConcatSpreadable"),m=9007199254740991,g="Maximum allowed index exceeded",b=a.TypeError,C=h>=51||!n((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),_=f("concat"),w=function(e){if(!c(e))return!1;var t=e[p];return void 0!==t?!!t:i(e)},y=!C||!_;s({target:"Array",proto:!0,forced:y},{concat:function(e){var t,r,s,a,n,i=o(this),c=d(i,0),f=0;for(t=-1,s=arguments.length;t<s;t++)if(n=-1===t?i:arguments[t],w(n)){if(a=u(n),f+a>m)throw b(g);for(r=0;r<a;r++,f++)r in n&&l(c,f,n[r])}else{if(f>=m)throw b(g);l(c,f++,n)}return c.length=f,c}})},a582:function(e,t,r){"use strict";r("c724")},a9e3:function(e,t,r){"use strict";var s=r("83ab"),a=r("da84"),n=r("e330"),i=r("94ca"),c=r("6eeb"),o=r("1a2d"),u=r("7156"),l=r("3a9b"),d=r("d9b5"),f=r("c04e"),v=r("d039"),h=r("241c").f,p=r("06cf").f,m=r("9bf2").f,g=r("408a"),b=r("58a8").trim,C="Number",_=a[C],w=_.prototype,y=a.TypeError,I=n("".slice),U=n("".charCodeAt),x=function(e){var t=f(e,"number");return"bigint"==typeof t?t:N(t)},N=function(e){var t,r,s,a,n,i,c,o,u=f(e,"number");if(d(u))throw y("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=b(u),t=U(u,0),43===t||45===t){if(r=U(u,2),88===r||120===r)return NaN}else if(48===t){switch(U(u,1)){case 66:case 98:s=2,a=49;break;case 79:case 111:s=8,a=55;break;default:return+u}for(n=I(u,2),i=n.length,c=0;c<i;c++)if(o=U(n,c),o<48||o>a)return NaN;return parseInt(n,s)}return+u};if(i(C,!_(" 0o1")||!_("0b1")||_("+0x1"))){for(var k,$=function(e){var t=arguments.length<1?0:_(x(e)),r=this;return l(w,r)&&v((function(){g(r)}))?u(Object(t),r,$):t},M=s?h(_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),E=0;M.length>E;E++)o(_,k=M[E])&&!o($,k)&&m($,k,p(_,k));$.prototype=w,w.constructor=$,c(a,C,$)}},ae72:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"private-main"},[r("UserSidebar"),r("div",{staticClass:"private-container"},[r("PrivateChatroom")],1)],1)},a=[],n=r("a004"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"chat-room"},[r("div",{staticClass:"chat-users"},[e._m(0),r("div",{staticClass:"list-group"},e._l(e.historyChatUsers,(function(t){return r("div",{key:t.id,staticClass:"list-group-item"},[r("div",{staticClass:"active-bar"}),r("div",{staticClass:"avatar",style:{background:"url("+(t?t.avatar:"")+") no-repeat center/cover"},on:{click:function(r){e.$router.push("/user/other/"+t.id).catch((function(){}))}}}),r("div",{staticClass:"info"},[r("div",{staticClass:"name",on:{click:function(r){e.$router.push("/user/other/"+t.id).catch((function(){}))}}},[e._v(" "+e._s(t.name)+" ")]),r("div",{staticClass:"account",on:{click:function(r){e.$router.push("/user/other/"+t.id).catch((function(){}))}}},[e._v(" "+e._s(t.account)+" ")])]),t.unread>0?r("div",{staticClass:"unread-wrapper"},[r("div",{staticClass:"unread"},[e._v(e._s(t.unread))])]):e._e()])})),0)]),r("PrivateMessengeBoard",{attrs:{messages:e.historyMessages,targetChannel:e.targetChannel},on:{sendPrivateMessage:e.receiveMessage}})],1)},c=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"title"},[e._v(" 訊息 "),r("div",{staticClass:"icon messege"})])}],o=r("1da1"),u=r("2909"),l=r("5530"),d=(r("96cf"),r("a9e3"),r("99af"),r("d3b7"),r("3ca3"),r("ddb0"),r("2fa3")),f=r("2f62"),v=r("4cce"),h={getPrivateChatRoom:function(e){var t=e.userId;return d["b"].get("/private/".concat(t))}},p=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"messenge-board"},[r("div",[r("div",{staticClass:"top-wrapper"},[r("div",{staticClass:"info"},[r("div",{staticClass:"name",on:{click:function(t){e.$router.push("/user/other/"+e.userId).catch((function(){}))}}},[e._v(" "+e._s("test.name")+" ")]),r("div",{staticClass:"account",on:{click:function(t){e.$router.push("/user/other/"+e.userId).catch((function(){}))}}},[e._v(" "+e._s("test.account")+" ")])])]),r("div",{ref:"boardWrapper",staticClass:"board-wrapper"},[r("div",{staticClass:"messages"},e._l(e.messages,(function(t){return r("div",{key:t.id},[e.currentUser.id!==t.UserId?r("div",{staticClass:"broacast-message-wrapper"},[r("div",{staticClass:"broacast-message"},[e._v(" "+e._s(e._f("fromNow")(t.createdAt))+" ")])]):e._e(),e.currentUser.id!==t.SenderId?r("div",{staticClass:"other message"},[r("div",{staticClass:"avatar",style:{background:"url("+(t.User?t.User.avatar:t.avatar)+") no-repeat center/cover"}}),r("div",{staticClass:"wrapper"},[r("div",{staticClass:"text"},[e._v(e._s(t.message))]),r("div",{staticClass:"time"},[e._v(e._s(e._f("fromNow")(t.createdAt)))])])]):e._e(),e.currentUser.id===t.SenderId?r("div",{staticClass:"self message"},[r("div",{staticClass:"text"},[e._v(e._s(t.message))]),r("div",{staticClass:"time"},[e._v(e._s(e._f("fromNow")(t.createdAt)))])]):e._e()])})),0)]),r("form",{on:{submit:function(t){return t.preventDefault(),e.sendMessage.apply(null,arguments)}}},[r("div",{staticClass:"text-wrapper"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"text",attrs:{placeholder:"輸入訊息...",onfocus:"this.placeholder = ''",onblur:"this.placeholder = '輸入訊息...'"},domProps:{value:e.message},on:{input:function(t){t.target.composing||(e.message=t.target.value)}}}),r("div",{staticClass:"icon-wrapper",attrs:{type:"submit"},on:{click:e.sendMessage}},[r("div",{staticClass:"icon send"})])])])]),r("div",{directives:[{name:"show",rawName:"v-show",value:0===e.messages.length,expression:"messages.length === 0"}],staticClass:"no-message-noti"},[r("div",[e._v("你沒有任何訊息")])])])},m=[],g=(r("498a"),r("2708")),b={props:{messages:{type:Array},targetChannel:{type:String}},mixins:[g["b"]],data:function(){return{message:""}},mounted:function(){var e=this;this.$socket.on("private_msg_from_backend",(function(t){console.log("private_msg==>",t),e.$emit("sendPrivateMessage",{SenderId:t.SenderId,ReceiverId:t.ReceiverId,message:t.message,createdAt:t.createdAt,targetChannel:t.targetChannel})})),this.$socket.on("unread_msg",(function(t){console.log("unread_msg===>",t),t.UserId===e.currentUser.id&&e.$bus.$emit("updateChatUsers",t)}))},beforeDestroy:function(){},watch:{},computed:Object(l["a"])({},Object(f["b"])(["currentUser","isAuthenticated"])),methods:{sendMessage:function(e){e.preventDefault(),""!==this.message.trim()?(this.$socket.emit("private message",{SenderId:this.currentUser.id,ReceiverId:this.$route.params.id,message:this.message,targetChannel:this.targetChannel}),this.message=""):d["a"].fire({icon:"error",title:"請輸入訊息"})}}},C=b,_=(r("0465"),r("2877")),w=Object(_["a"])(C,p,m,!1,null,null,null),y=w.exports,I={components:{PrivateMessengeBoard:y},data:function(){return{allHistoryMessages:[],historyMessages:[],targetChannel:"",users:[],privateRoomData:{},historyChatUsers:{}}},mounted:function(){var e=this,t=this.$route.params.id;return this.$bus.$on("updateChatUsers",(function(t){e.updateChatUsers(t)})),this.targetChannel=Number(t)>Number(this.currentUser.id)?"".concat(this.currentUser.id,"_").concat(t):"".concat(t,"_").concat(this.currentUser.id),Promise.all([this.fetchUsers(t),this.fetchPrivateChatroom(t)]).then((function(){e.$socket.emit("private chatroom",e.targetChannel)}))},beforeDestroy:function(){this.$socket.emit("leave private chatroom",this.targetChannel),this.$bus.$off("updateChatUsers")},computed:Object(l["a"])({},Object(f["b"])(["currentUser","isAuthenticated"])),watch:{historyChatUsers:function(){}},methods:{receiveMessage:function(e){this.allHistoryMessages=[].concat(Object(u["a"])(this.allHistoryMessages),[e]),this.historyMessages=this.allHistoryMessages},fetchPrivateChatroom:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var s,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,h.getPrivateChatRoom({userId:e});case 3:return s=r.sent,a=s.data,console.log("getPrivateChatRoom==>",a),t.privateRoomData=a,t.allHistoryMessages=Object(u["a"])(a),t.historyMessages=Object(u["a"])(a),r.abrupt("return",t.privateRoomData);case 12:r.prev=12,r.t0=r["catch"](0),console.log(r.t0),d["a"].fire({icon:"error",title:"目前無法連線聊天室，請稍候"});case 16:case"end":return r.stop()}}),r,null,[[0,12]])})))()},fetchUsers:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var s,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,v["a"].getProfile({userId:e});case 3:return s=r.sent,a=s.data,t.users=a,r.abrupt("return",t.users);case 9:r.prev=9,r.t0=r["catch"](0),console.log(r.t0),d["a"].fire({icon:"error",title:"目前無法取得資料，請稍候"});case 13:case"end":return r.stop()}}),r,null,[[0,9]])})))()},updateChatUsers:function(e){return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("updateChatUsers",e);case 1:case"end":return t.stop()}}),t)})))()}}},U=I,x=(r("f24e"),Object(_["a"])(U,i,c,!1,null,null,null)),N=x.exports,k={components:{UserSidebar:n["a"],PrivateChatroom:N}},$=k,M=(r("a582"),Object(_["a"])($,s,a,!1,null,null,null));t["default"]=M.exports},c724:function(e,t,r){},c8d2:function(e,t,r){var s=r("5e77").PROPER,a=r("d039"),n=r("5899"),i="​᠎";e.exports=function(e){return a((function(){return!!n[e]()||i[e]()!==i||s&&n[e].name!==e}))}},e71b:function(e,t,r){},f1c1:function(e,t,r){},f24e:function(e,t,r){"use strict";r("f1c1")}}]);
//# sourceMappingURL=chunk-66710989.8c1237c3.js.map